---
sidebar_position: 7
---

# 数据同步

:::info
未整理完

请先参考

- [GitHub 同步配置指南](https://github.com/utags/utags/discussions/58)
- [WebDAV 同步配置指南](https://github.com/utags/utags/discussions/59)

:::

本章节将详细介绍 UTags 的数据同步功能，帮助您在多设备间保持标签和书签数据的一致性。

## 同步方式介绍

UTags 提供多种数据同步方式，您可以根据自己的需求选择最适合的方式：

### 本地存储（默认）

- **存储位置**：数据存储在浏览器的本地存储中
- **优点**：无需配置，立即可用，完全私密
- **缺点**：数据仅限于当前浏览器，无法跨设备同步
- **适用场景**：单设备使用，或不需要跨设备同步的场景

### GitHub 同步

- **存储位置**：数据存储在您的 GitHub 仓库中（公开或私有）
- **优点**：免费，可靠，支持版本控制，可跨设备同步
- **缺点**：需要 GitHub 账号和个人访问令牌，配置略复杂
- **适用场景**：需要跨设备同步，熟悉 GitHub 的用户

### WebDAV 同步

- **存储位置**：数据存储在您的 WebDAV 服务器上
- **优点**：完全自主控制，可使用自托管或第三方 WebDAV 服务
- **缺点**：需要 WebDAV 服务器，可能需要付费
- **适用场景**：注重隐私，希望完全控制数据存储的用户

### 手动导入/导出

- **存储位置**：数据导出为文件，可手动传输和导入
- **优点**：简单，无需配置，完全离线
- **缺点**：需要手动操作，不支持自动同步
- **适用场景**：临时迁移数据，或不经常需要同步的场景

## GitHub 同步设置

### 准备工作

在设置 GitHub 同步之前，您需要：

1. 拥有一个 GitHub 账号
2. 创建一个个人访问令牌（Personal Access Token）

### 创建 GitHub 个人访问令牌

1. 登录您的 GitHub 账号
2. 点击右上角头像，选择 Settings（设置）
3. 在左侧菜单中选择 Developer settings（开发者设置）
4. 选择 Personal access tokens（个人访问令牌）
5. 点击 Generate new token（生成新令牌）
6. 为令牌添加描述，如 "UTags Sync"
7. 选择以下权限：
   - `repo`（如果使用私有仓库）
   - `public_repo`（如果使用公开仓库）
8. 点击 Generate token（生成令牌）
9. 复制生成的令牌（重要：令牌只会显示一次）

### 在 UTags 中设置 GitHub 同步

#### 浏览器扩展/用户脚本设置

1. 点击浏览器工具栏中的 UTags 图标
2. 选择"设置"
3. 在设置页面中选择"数据同步"
4. 选择"GitHub 同步"
5. 输入以下信息：
   - **GitHub 用户名**：您的 GitHub 用户名
   - **仓库名称**：用于存储数据的仓库名称（可以是现有仓库或新仓库）
   - **分支名称**：存储数据的分支（默认为 `main` 或 `master`）
   - **文件路径**：数据文件的路径（默认为 `utags.json`）
   - **个人访问令牌**：之前创建的个人访问令牌
6. 点击"保存"按钮
7. 点击"测试连接"按钮验证配置是否正确
8. 如果测试成功，点击"同步数据"按钮进行首次同步

![GitHub同步设置截图](../assets/github-sync-setup.png)

#### 网页应用设置

1. 访问 UTags 网页应用
2. 点击右上角的设置图标
3. 在设置页面中选择"数据同步"
4. 选择"GitHub 同步"
5. 输入与浏览器扩展/用户脚本相同的配置信息
6. 点击"保存"按钮
7. 点击"测试连接"按钮验证配置是否正确
8. 如果测试成功，点击"同步数据"按钮进行首次同步

### GitHub 同步注意事项

1. **数据隐私**：如果使用公开仓库，您的标签数据将对所有人可见。如果隐私很重要，请使用私有仓库。
2. **冲突解决**：如果在多个设备上同时修改数据，可能会发生冲突。UTags 会尝试自动解决冲突，但在某些情况下可能需要手动干预。
3. **同步频率**：默认情况下，UTags 会在数据变更时自动同步。您可以在设置中调整同步频率。
4. **令牌安全**：个人访问令牌具有访问您 GitHub 账号的权限，请妥善保管，不要泄露给他人。

## WebDAV 同步设置

### 准备工作

在设置 WebDAV 同步之前，您需要：

1. 拥有一个支持 WebDAV 的服务器或云存储服务
2. 获取 WebDAV 服务器的地址、用户名和密码

### 常见的 WebDAV 服务提供商

- **Nextcloud/ownCloud**：自托管云存储解决方案，支持 WebDAV
- **Box.com**：提供 WebDAV 访问的云存储服务
- **Yandex.Disk**：支持 WebDAV 的云存储服务
- **4shared**：提供 WebDAV 访问的文件共享服务
- **DriveHQ**：企业云 IT 服务，支持 WebDAV

### 在 UTags 中设置 WebDAV 同步

#### 浏览器扩展/用户脚本设置

1. 点击浏览器工具栏中的 UTags 图标
2. 选择"设置"
3. 在设置页面中选择"数据同步"
4. 选择"WebDAV 同步"
5. 输入以下信息：
   - **WebDAV 服务器地址**：您的 WebDAV 服务器完整 URL
   - **用户名**：WebDAV 账号的用户名
   - **密码**：WebDAV 账号的密码
   - **文件路径**：数据文件的路径（默认为 `/utags.json`）
6. 点击"保存"按钮
7. 点击"测试连接"按钮验证配置是否正确
8. 如果测试成功，点击"同步数据"按钮进行首次同步

![WebDAV同步设置截图](../assets/webdav-sync-setup.png)

#### 网页应用设置

1. 访问 UTags 网页应用
2. 点击右上角的设置图标
3. 在设置页面中选择"数据同步"
4. 选择"WebDAV 同步"
5. 输入与浏览器扩展/用户脚本相同的配置信息
6. 点击"保存"按钮
7. 点击"测试连接"按钮验证配置是否正确
8. 如果测试成功，点击"同步数据"按钮进行首次同步

### WebDAV 同步注意事项

1. **HTTPS 连接**：为了保证数据传输安全，强烈建议使用 HTTPS 连接的 WebDAV 服务器。
2. **路径格式**：不同的 WebDAV 服务器可能有不同的路径格式要求，请参考您的 WebDAV 服务提供商的文档。
3. **同步频率**：默认情况下，UTags 会在数据变更时自动同步。您可以在设置中调整同步频率。
4. **凭据安全**：WebDAV 用户名和密码会存储在浏览器中，请确保您的设备安全。

## 数据导入/导出

### 导出数据

1. 在 UTags 网页应用或浏览器扩展的设置中，选择"数据管理"
2. 点击"导出数据"按钮
3. 选择导出格式：
   - JSON（完整备份，推荐）
   - HTML（与浏览器书签兼容）
   - CSV（与电子表格软件兼容）
4. 点击"导出"按钮
5. 保存文件到您的计算机

![数据导出界面截图](../assets/data-export.png)

## 多设备同步最佳实践

### 同步策略

1. **选择一种主要同步方式**：建议在所有设备上使用相同的同步方式，以避免数据不一致。
2. **定期备份**：即使使用同步功能，也建议定期导出数据作为备份。
3. **避免冲突**：尽量避免在多个设备上同时编辑相同的标签或书签。

### 同步顺序

当您在新设备上设置 UTags 时，建议按以下顺序操作：

1. 安装 UTags 浏览器扩展/用户脚本或访问网页应用
2. 在设置中配置与其他设备相同的同步方式
3. 执行"从服务器同步"操作，获取最新数据
4. 验证数据是否正确同步
5. 开始正常使用

### 解决同步冲突

如果发生同步冲突，UTags 会尝试自动解决。但在某些情况下，您可能需要手动干预：

1. 如果收到冲突通知，查看冲突详情
2. 选择保留本地版本、远程版本或合并两者
3. 如果选择合并，可能需要手动编辑某些冲突的标签
4. 解决冲突后，执行手动同步以确保数据一致

### 同步故障排除

如果遇到同步问题，请尝试以下步骤：

1. **检查网络连接**：确保设备可以访问互联网和同步服务器
2. **验证凭据**：确保同步配置中的用户名、密码或令牌正确
3. **检查服务状态**：确认 GitHub 或 WebDAV 服务器正常运行
4. **清除缓存**：在设置中选择"清除同步缓存"，然后重新同步
5. **查看同步日志**：在设置中查看同步日志，了解详细错误信息
6. **重新配置**：如果问题持续，尝试删除同步配置并重新设置

## 数据迁移

### 从其他书签管理器迁移到 UTags

1. 从原书签管理器导出数据（通常为 HTML 或 CSV 格式）
2. 在 UTags 网页应用的设置中选择"数据管理"
3. 点击"导入书签"
4. 选择导入格式和文件
5. 按照提示完成导入过程
6. 导入后，可能需要手动调整标签结构

### 在同步方式之间迁移

如果您想从一种同步方式切换到另一种，请按以下步骤操作：

1. 确保当前数据已完全同步
2. 导出当前数据作为备份
3. 在设置中配置新的同步方式
4. 选择"上传本地数据"，将当前数据上传到新的同步服务器
5. 验证数据是否正确同步
6. 如果一切正常，可以删除旧的同步配置
